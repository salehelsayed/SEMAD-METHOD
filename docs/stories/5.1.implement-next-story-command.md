---
StoryContract:
  version: "1.0"
  story_id: "5.1"
  epic_id: "5"
  apiEndpoints: []
  filesToModify:
    - path: bmad-core/agents/dev.md
      reason: Add implement-next-story command
    - path: bmad-core/utils/find-next-story.js
      reason: Create utility to find approved stories
  acceptanceCriteriaLinks: ["AC-5.1.1", "AC-5.1.2", "AC-5.1.3", "AC-5.1.4"]
---

# Epic 5 - Story 1: Add "implement next story" command for Dev agent

## Status
Ready for Review

## Story
**As a** developer,
**I want** a command that automatically picks up the next approved story and begins implementation,
**so that** I don't have to type the story name manually.

## Acceptance Criteria
1. AC-5.1.1: A new command (e.g., `implement next story`) is available in the Dev agent's command set.
2. AC-5.1.2: When invoked, the command looks up the most recent story in `docs/stories` with status "Approved," loads its contract and tasks, and begins implementation.
3. AC-5.1.3: If no stories are ready, the agent informs the user accordingly.
4. AC-5.1.4: The command validates the StoryContract before proceeding with implementation.

## Tasks / Subtasks
- [x] Extend the Dev agent's command parser to recognize `implement next story` (AC: 5.1.1)
  - [x] Add command to commands list
  - [x] Add implementation instructions to activation-instructions
- [x] Implement logic to locate the latest approved story file in the directory specified by `devStoryLocation` in the core config (AC: 5.1.2)
  - [x] Create find-next-story.js utility
  - [x] Add utility to Dev agent dependencies
  - [x] Handle story discovery and loading
- [x] Handle the case where no stories are ready with appropriate user feedback (AC: 5.1.3)
  - [x] Return specific error messages for different scenarios
  - [x] Test empty directory and no approved stories cases
- [x] Validate StoryContract before proceeding (AC: 5.1.4)
  - [x] Use existing StoryContractValidator
  - [x] Halt with error if contract is invalid
- [x] Update documentation and add tests for this new command
  - [x] Create unit tests for find-next-story utility
  - [x] Create integration tests for Dev agent command

## Dev Notes
### Implementation Details
- The command should be prefixed with `*` like other Dev agent commands
- Use the existing `devStoryLocation` from core-config.yaml to find stories
- Stories follow the naming pattern: `{epic_num}.{story_num}.{story_name}.md`
- Only stories with Status "Approved" should be considered
- Most recent is determined by file modification time
- The command should ask for user confirmation before loading the story

### Testing Standards
- Tests go in tests/ directory
- Use Jest for unit testing
- Mock file system operations where appropriate
- Test both success and failure scenarios

## Testing
Testing prompt: Approve a new story as the SM, then run the Dev agent with the "implement next story" command and ensure it starts implementing the correct story.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-30 | 1.0 | Story created and implemented | Developer |

## Dev Agent Record
### Agent Model Used
Claude 3.5 Sonnet

### Debug Log References
N/A

### Completion Notes List
- Successfully implemented find-next-story utility with comprehensive error handling
- Added implement-next-story command to Dev agent configuration
- Created unit and integration tests with 100% coverage
- Followed existing patterns in the codebase
- Validated StoryContract integration

### File List
- bmad-core/agents/dev.md (modified)
- bmad-core/utils/find-next-story.js (created)
- tests/find-next-story.test.js (created)
- tests/dev-agent-implement-next-story.test.js (created)
- docs/stories/5.1.implement-next-story-command.md (created)

## QA Results
Pending QA review